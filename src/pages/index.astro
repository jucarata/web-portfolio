---
// Página principal del portfolio
import "../styles/global.css";
import "../styles/animations/curtains.css";
import "../styles/animations/work.css";
import Navbar from "../components/Navbar.astro";
import ProjectModal from "../components/ProjectModal.astro";
import { Linkedin, Github, Mail, FileDown } from "@lucide/astro";
import { getCurrentLanguage, t } from "../consts/i18n.js";

// Cargar proyectos según el idioma (default: en para SSR)
const currentLang = typeof window !== 'undefined' 
  ? (localStorage.getItem('language') || 'en')
  : 'en';

// Importar proyectos según el idioma
let projects;
if (currentLang === 'es') {
  const projectsModule = await import("../consts/projects.es.js");
  projects = projectsModule.projects;
} else {
  const projectsModule = await import("../consts/projects.en.js");
  projects = projectsModule.projects;
}

// Función helper para construir rutas con base path
const getImageUrl = (path) => {
  const base = import.meta.env.BASE_URL || '';
  // Si la ruta ya tiene el base path, no duplicarlo
  if (path.startsWith(base)) {
    return path;
  }
  // Construir la ruta completa con base path
  const cleanPath = path.startsWith('/') ? path : '/' + path;
  const basePath = base.endsWith('/') ? base.slice(0, -1) : base;
  return basePath + cleanPath;
};

// Construir URLs de imágenes con base path
const projectsWithUrls = projects.map(project => ({
  ...project,
  image_url: getImageUrl(project.image_url)
}));
---

<html lang={currentLang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jucara - Portfolio</title>
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  </head>
  <body>
    <Navbar />
    <ProjectModal />
    <main class="home" id="home">
      <div class="curtains-container" id="curtains">
        <div class="curtain curtain-left"></div>
        <div class="curtain curtain-right"></div>
      </div>
      <div class="container">
        <div class="greeting">
          <h1 class="greeting-text" data-i18n="greeting">{t('greeting', currentLang)}</h1>
          <h2 class="brand-name">Jucara</h2>
        </div>
        <div class="social-links" aria-label="Redes de contacto">
          <a class="social-link" href="https://www.linkedin.com/in" aria-label="LinkedIn" data-tooltip="LinkedIn" target="_blank" rel="noopener noreferrer">
            <Linkedin size={22} strokeWidth={1.8} />
          </a>
          <a class="social-link" href="https://github.com/jucarata" aria-label="GitHub" data-tooltip="GitHub" target="_blank" rel="noopener noreferrer">
            <Github size={22} strokeWidth={1.8} />
          </a>
          <a class="social-link" href="mailto:contact.jucara+portfolio@gmail.com " aria-label={t('email', currentLang)} data-tooltip={t('email', currentLang)}>
            <Mail size={22} strokeWidth={1.8} />
          </a>
          <a class="social-link" href="#" aria-label={t('downloadCV', currentLang)} data-tooltip={t('downloadCV', currentLang)}>
            <FileDown size={22} strokeWidth={1.8} />
          </a>
        </div>
      </div>
    </main>
    <!-- Sección Work -->
    <section class="content-section" id="work">
      <div class="section-content">
        <h2 class="section-title" data-i18n="work">{t('work', currentLang).toUpperCase()}</h2>
        <div class="work-carousel work-marquee" aria-label="Proyectos">
          <div class="work-track work-track-marquee">
            {projectsWithUrls.map((project, index) => (
              <article class="work-card" data-project-index={index}>
                <div class="work-image">
                  <img src={project.image_url} alt={`${t('project', currentLang)} ${project.name}`} loading="lazy" />
                </div>
                <div class="work-card-content">
                  <h3 class="work-title">{project.name}</h3>
                  <span class={`work-state work-state-${project.state.toLowerCase()}`}>
                    {project.state}
                  </span>
                </div>
              </article>
            ))}
            {projectsWithUrls.map((project) => (
              <article class="work-card" aria-hidden="true">
                <div class="work-image">
                  <img src={project.image_url} alt="" loading="lazy" />
                </div>
                <div class="work-card-content">
                  <h3 class="work-title">{project.name}</h3>
                  <span class={`work-state work-state-${project.state.toLowerCase()}`}>
                    {project.state}
                  </span>
                </div>
              </article>
            ))}
          </div>
        </div>
      </div>
    </section>
    <script>
      import { initAll } from "../scripts/main.js";
      initAll();
    </script>
  </body>
</html>
